# ESPHome Device Configuration Framework

This repository contains a structured, reusable ESPHome configuration and build system for managing multiple embedded devices with consistent standards.

---

## 📁 Project Layout

```text
.
├── Makefile
├── README.md
├── VERSION
├── Doxyfile
├── configure.sh
├── main.yaml
├── common/
│   ├── logging.yaml
│   ├── ota.yaml
│   ├── secrets.yaml       # Not tracked (gitignored)
│   ├── web_server.yaml
│   └── wifi.yaml
├── .gitignore
├── .makefile              # Autogenerated per-device
└── <DEVICE_NAME>/
    ├── VERSION
    ├── common/
    │   └── ...            # Copied from root common/
    └── <DEVICE_NAME>.yaml

```

---

## 🚀 Features

- YAML configuration templating via `envsubst`
- Automatic interactive `.makefile` generation
- Optional static IP configuration
- Per-device isolated build artifacts
- Logging, OTA, display, secrets, and Wi-Fi modularized under `common/`
- Doxygen documentation support

---

## 🛠️ Getting Started

1. Clone the repo and run:

```bash
make
```

2. If `.makefile` does not exist, the script will prompt you to define:

- `DEVICE_NAME` (e.g. `sysmon-ph`)
- `NODE_NAME` (used for mDNS, should match or differ from device name)
- `FRIENDLY_NAME` (display name for Home Assistant)
- `COM_PORT` (e.g. `COM7`)
- Optional: Static IP, Gateway, Subnet, DNS

3. The following will be generated:

- `.makefile` with your selections
- `main.yaml` → `<DEVICE_NAME>/<DEVICE_NAME>.yaml`
- Copied `common/` directory and `VERSION` file into your device folder

---

## 🧹 Maintenance Commands

```bash
make run       # Compile, upload, and stream logs
make build     # Just compile
make upload    # Upload + logs
make config    # Regenerate device config
make clean     # Remove generated device config
make clobber   # Remove config + .makefile and reset
make docs      # Generate documentation using Doxygen
```

---

## 🧾 Documentation

To generate project documentation:

```bash
make docs
```

Ensure you have a valid `Doxyfile` in the project root.

---

## ⚠️ Secrets

- Secrets are stored in `common/secrets.yaml`
- This file is excluded from version control
- Use `!secret` in YAML to reference secure fields

---

## 🙏 Co-Authorship

This project was co-developed by:

- **Roland Tembo Hendel** (author, architect)
- **ChatGPT by OpenAI** (co-author, automation + documentation)

All code, automation, and documentation were designed through conversational collaboration.

---

## 📜 License

Licensed under the GNU General Public License v3.0  
SPDX-License-Identifier: GPL-3.0-or-later
