# GitHub Copilot Session Context

## Project Overview
**ESPHome IoT Device Development Environment**
- **Platform**: Windows + Cygwin + zsh + VS Code
- **Device**: ESP32-S3 based system monitor ("sysmon-ph")
- **ESPHome Version**: 2025.6.3
- **Build System**: Professional Makefile with 24 targets, auto-detected Python, comprehensive cleanup system

## Current Session Status
**Last Updated**: July 18, 2025

### Development Environment Status
- âœ… **Terminal Setup**: Cygwin zsh configured with Meslo Nerd Font
- âœ… **VS Code Integration**: Complete tasks.json with 9 ESPHome targets
- âœ… **Build System**: Professional Makefile with 24 targets, auto-detected Python with esptool
- âœ… **Documentation System**: Organized docs structure (docs/esphome/, docs/html/, docs/latex/)
- âœ… **Flash Operations**: Full esptool integration (erase, info, verify)
- âœ… **Safety Systems**: PROTECTED_DIRS, dependency composition, comprehensive error handling
- âœ… **Professional Headers**: Consistent versioning, proper attribution, Doxygen-style documentation

### Current Work Status
- âœ… **Makefile Optimization**: Complete professional overhaul with 24 targets
- âœ… **Python Auto-detection**: Sophisticated fallback chain for esptool availability
- âœ… **Code Quality**: Consistent @ symbol placement, professional commenting, clean spacing
- âœ… **Session Continuity**: GIT-COPILOT.md system for seamless restart capability
- âœ… **Header Standardization**: Professional documentation headers with version tracking
- âœ… **Version Consistency**: Makefile version synchronized with VERSION file (0.3.0)
- ðŸŽ¯ **Status**: Professional-grade development environment fully operational

## Technical Configuration

### Makefile Targets (24 Total)
```bash
# Build Targets
make configure      # Interactive setup (.makefile generation)
make build          # Compile firmware (output to build.log)

# Platform Targets  
make flash-erase    # Erase ESP32-S3 flash (WARNING: destructive!)
make chip-info      # Display ESP32-S3 chip information
make flash-info     # Display flash memory layout
make flash-verify   # Verify flash contents against firmware build
make upload         # Upload firmware to device
make logs           # Stream live logs
make run            # Build + Upload + Logs pipeline

# Documentation Targets
make docs           # Generate all documentation (ESPHome + Doxygen)
make docs-esphome   # Generate ESPHome component documentation
make docs-doxygen   # Generate Doxygen HTML/PDF documentation

# Cleanup Targets
make clean          # Remove temporary build artifacts
make clean-cache    # Remove ESPHome build cache
make clean-docs     # Remove all generated documentation
make clean-docs-esphome    # Remove only ESPHome docs
make clean-docs-doxygen    # Remove only Doxygen docs
make clobber        # Remove entire device directory
make distclean      # Complete cleanup for archive/export

# Utility Targets
make version        # Show platform and ESPHome versions
make buildvars      # Show current build configuration
make help           # Display professional help banner
```

### VS Code Tasks Available
```json
// All tasks use zsh shell: /bin/zsh
1. "ESPHome: Configure"     - Interactive setup
2. "ESPHome: Build"         - Compile firmware  
3. "ESPHome: Upload"        - Flash device
4. "ESPHome: Logs"          - Stream live logs
5. "ESPHome: Run"           - Build + Upload + Logs
6. "ESPHome: Generate Docs" - Create documentation
7. "ESPHome: Clean"         - Remove build cache
8. "ESPHome: Show Version"  - Display versions
9. "ESPHome: Show Variables" - Display config
```

### Key Files & Locations
- **Device Config**: `sysmon-ph/sysmon-ph.yaml` (generated from main.yaml)
- **WiFi Config**: `common/wifi.yaml` + `common/secrets.yaml`
- **Build Output**: `build.log` (auto-captured via tee)
- **Main Template**: `main.yaml`
- **Device Variables**: `.makefile` (generated by configure.sh)
- **Documentation**: `docs/esphome/` (component docs), `docs/html/` (Doxygen HTML), `docs/latex/` (Doxygen PDF)

### Recent Major Improvements
1. **Professional Makefile**: Complete overhaul with 24 targets, auto-detected Python, comprehensive cleanup
2. **Python Auto-detection**: Sophisticated fallback chain for esptool availability across installations
3. **Documentation System**: Organized structure with separate directories for different doc types
4. **Flash Operations**: Complete esptool integration (erase, chip-info, flash-info, flash-verify)
5. **Safety Systems**: PROTECTED_DIRS, dependency composition, professional error handling
6. **Code Quality**: Consistent @ symbol placement, professional commenting, clean spacing with double blank lines
7. **Session Continuity**: GIT-COPILOT.md system for seamless development restart
8. **Professional Headers**: Standardized documentation headers with version tracking and proper attribution
9. **Version Consistency**: Makefile version synchronized with VERSION file (0.3.0) for single source of truth

## Advanced Features

### Auto-detected Python with esptool
```makefile
PYTHON_WITH_ESPTOOL := $(shell \
    for py in python3 python /cygdrive/c/Users/rhendel/AppData/Local/Programs/Python/Python313/python.exe; do \
        if "$$py" -c "import esptool" 2>/dev/null; then echo "$$py"; break; fi \
    done)
```

### Safety Mechanisms
- **PROTECTED_DIRS**: Prevents accidental deletion of critical directories
- **Dependency Composition**: Clean, maintainable target dependencies
- **Error Handling**: Comprehensive error messages and recovery suggestions
- **Flash Safety**: 5-second warning before destructive flash operations

### Documentation Generation
- **ESPHome Docs**: Component-level documentation with timestamps
- **Doxygen Integration**: HTML and PDF generation from YAML files
- **Organized Structure**: Separate directories for different documentation types

## WiFi Troubleshooting Context

### Current WiFi Configuration
```yaml
# From common/wifi.yaml
wifi:
  networks:
    - ssid: !secret wifi_ssid
      password: !secret wifi_password
  power_save_mode: none
  reboot_timeout: 30s
  ap:
    ssid: "Sysmon-Ph Fallback Hotspot"
    password: "NeverUsePlaintextPasswords!"
```

### Known Issues
- Device experiencing WiFi AP registration problems
- Need to capture live logs during connection attempts
- May need to modify logs target to include tee logging for shared visibility

## Quick Start Commands

### Session Restart Procedure
1. Open VS Code in workspace: `c:\cygwin64\home\rhendel\git\AW-Toolbox\joi\esphome`
2. Verify environment: `make version` or `make help`
3. Check current config: `make buildvars`
4. Review last build: `cat build.log`

### Development Workflow
1. **Configure**: `make configure` (interactive setup)
2. **Build**: `make build` (compile firmware, output to build.log)
3. **Upload**: `make upload` (flash device)
4. **Debug**: `make logs` (stream live logs)
5. **Full Pipeline**: `make run` (build + upload + logs)

### Check-in Process
1. **Pre-Commit**: Follow `CHECKIN-CHECKLIST.md` validation steps
2. **Clean Build**: `make clean && make build` (verify no warnings)
3. **Version Bump**: Update `VERSION` file and Makefile header
4. **Archive Test**: `make distclean` (ensure clean workspace)
5. **Commit**: Use structured commit message format
6. **Post-Commit**: Update continuity files (KIBO.md, GIT-COPILOT.md)

### Documentation Generation
1. **All Docs**: `make docs` (ESPHome + Doxygen)
2. **ESPHome Only**: `make docs-esphome` (component documentation)
3. **Doxygen Only**: `make docs-doxygen` (HTML/PDF from YAML)

### Flash Operations
1. **Chip Info**: `make chip-info` (ESP32-S3 capabilities)
2. **Flash Info**: `make flash-info` (memory layout)
3. **Flash Verify**: `make flash-verify` (verify against firmware)
4. **Flash Erase**: `make flash-erase` (WARNING: destructive!)

### Cleanup Operations
1. **Basic Clean**: `make clean` (temporary files)
2. **Cache Clean**: `make clean-cache` (ESPHome build cache)
3. **Docs Clean**: `make clean-docs` (all documentation)
4. **Full Clean**: `make clobber` (entire device directory)
5. **Archive Clean**: `make distclean` (complete cleanup)

## Development Workflow

### Standard Development Cycle
1. **Modify** configuration in `main.yaml` or `common/*.yaml`
2. **Build** via `make build` or VS Code task
3. **Upload** via `make upload` or VS Code task
4. **Debug** via `make logs` or live log analysis

### Professional Development Features
- **Auto-detected Python**: Sophisticated fallback chain for esptool
- **Safety Mechanisms**: PROTECTED_DIRS prevent accidental deletion
- **Comprehensive Help**: `make help` provides professional banner
- **Error Handling**: Detailed error messages with recovery suggestions
- **Session Continuity**: GIT-COPILOT.md preserves development state

## Action Items

### Immediate Tasks
- [ ] Test flash-verify functionality with current firmware
- [ ] Explore additional esptool functions if needed
- [ ] Continue ESPHome development with professional build system

### Session Continuity
- [x] Update GIT-COPILOT.md with latest improvements
- [x] Document professional Makefile system
- [x] Record session context for seamless restarts

## Notes & Observations

### Major Accomplishments
- **Professional Makefile**: 24 targets with comprehensive functionality
- **Auto-detected Python**: Sophisticated esptool integration
- **Documentation System**: Organized structure with multiple output formats
- **Flash Operations**: Complete esptool integration for ESP32-S3
- **Code Quality**: Consistent formatting, professional commenting
- **Safety Systems**: PROTECTED_DIRS, error handling, dependency composition
- **Professional Headers**: Standardized documentation with version tracking and proper attribution
- **Version Management**: Consistent versioning across all components with single source of truth

### Development Environment Quality
- **Terminal**: Cygwin zsh works perfectly with make commands
- **Font**: Meslo Nerd Font provides proper Unicode support
- **Build System**: Template substitution from .makefile works reliably
- **VS Code Integration**: Tasks provide seamless development workflow
- **Professional Grade**: Makefile meets enterprise-level standards
- **Documentation Standards**: Doxygen-style headers with GPL v3.0 licensing and proper attribution

### Tips for Future Sessions
1. Always start by reading this file for context
2. Use `make help` to see all available targets
3. Check `build.log` for recent compilation results
4. Use `make buildvars` to confirm current device configuration
5. Professional Makefile provides comprehensive development workflow
6. Session continuity maintained through this documentation system
7. Version consistency maintained between VERSION file and all component headers

---
*This file is maintained by GitHub Copilot to preserve session context and development state.*
*Updated to reflect professional-grade Makefile improvements and comprehensive development environment.*
